- name: Template {{ template_tf }}.tf.j2 to {{ hostname }}.tf
  ansible.builtin.template:
    src: "{{ template_tf }}.tf.j2"
    dest: "{{ playbook_dir }}/autogenerated/terraform_run/{{ hostname }}.tf"
    mode: '0644'
  delegate_to: localhost

- name: Template {{ bootstrap_ansible.sh }}.tf.j2 to bootstrap_ansible_{{ hostname }}.sh
  ansible.builtin.template:
    src: "bootstrap_ansible.sh.j2"
    dest: "{{ playbook_dir }}/autogenerated/manual_scripts/bootstrap_ansible_{{ hostname }}.sh"
    mode: '0644'
  delegate_to: localhost


- name: Run Terraform for {{ hostname }}
  cloud.terraform.terraform:
    project_path: "{{ playbook_dir }}/autogenerated/terraform_run"
    state: present
    force_init: true
    provider_upgrade: true
    lock: true
    targets:
      - proxmox_virtual_environment_container.{{ hostname }}
  delegate_to: localhost
  register: tf_output


- name: Display Terraform output for Docker LXC
  ansible.builtin.debug:
    msg: "{{ tf_output }}"
  delegate_to: localhost  # Added this to run locally

